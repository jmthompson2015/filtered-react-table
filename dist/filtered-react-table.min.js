!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FilteredReactTable=t()}(this,(function(){"use strict";const e={APPLY_FILTERS:"applyFilters",APPLY_SHOW_COLUMNS:"applyShowColumns",REMOVE_FILTERS:"removeFilters",SET_APP_NAME:"setAppName",SET_FILTER_GROUP:"setFilterGroup",SET_TABLE_COLUMNS:"setTableColumns",SET_TABLE_ROWS:"setTableRows",SET_VERBOSE:"setVerbose"};Object.freeze(e);const t={},r=(e,...t)=>(...r)=>{const o={type:e};return t.forEach(((e,s)=>{o[t[s]]=r[s]})),o};t.applyFilters=r(e.APPLY_FILTERS),t.applyShowColumns=r(e.APPLY_SHOW_COLUMNS,"columnToChecked"),t.removeFilters=r(e.REMOVE_FILTERS),t.setAppName=r(e.SET_APP_NAME,"appName"),t.setFilterGroup=r(e.SET_FILTER_GROUP,"filterGroup"),t.setTableColumns=r(e.SET_TABLE_COLUMNS,"tableColumns"),t.setTableRows=r(e.SET_TABLE_ROWS,"tableRows"),t.setVerbose=r(e.SET_VERBOSE,"isVerbose"),Object.freeze(t);const o={observeStore:(e,t,r)=>{let o;const s=()=>{const s=t(e.getState());s!==o&&(o=s,r(s))},l=e.subscribe(s);return s(),l}};Object.freeze(o);const s={},l=e=>{const t=localStorage.getItem(e);return void 0!==t?JSON.parse(t):{}};s.getColumnToChecked=e=>{const t=l(e);return t&&t.columnToChecked?Immutable(t.columnToChecked):Immutable({})},s.setColumnToChecked=(e,t)=>{const r=l(e),o=R.merge(r,{columnToChecked:t});localStorage.setItem(e,JSON.stringify(o))},s.getFilterGroup=e=>{const t=l(e);return t&&t.filterGroup?Immutable(t.filterGroup):Immutable([])},s.setFilterGroup=(e,t)=>{const r=l(e),o=R.merge(r,{filterGroup:t});localStorage.setItem(e,JSON.stringify(o))},Object.freeze(s);const a={create:({appName:e="FilteredReactTable",columnToChecked:t={},filteredTableRows:r=[],filterGroup:o,isVerbose:s=!1,tableColumns:l=[],tableRows:a=[]}={})=>Immutable({appName:e,columnToChecked:t,filteredTableRows:r,filterGroup:o,isVerbose:s,tableColumns:l,tableRows:a})};Object.freeze(a);const{Filter:n,FilterGroup:c}=FilterJS,i={root:(t,r)=>{if(void 0===t)return a.create();let o;switch(r.type){case e.APPLY_FILTERS:return t.isVerbose&&console.log("Reducer APPLY_FILTERS"),o=i.filterTableRows(t.tableRows,t.filterGroup),R.assoc("filteredTableRows",o,t);case e.APPLY_SHOW_COLUMNS:return t.isVerbose&&console.log(`Reducer APPLY_SHOW_COLUMNS columnToChecked = ${JSON.stringify(r.columnToChecked)}`),s.setColumnToChecked(t.appName,Immutable(r.columnToChecked)),R.assoc("columnToChecked",r.columnToChecked,t);case e.REMOVE_FILTERS:return t.isVerbose&&console.log("Reducer REMOVE_FILTERS"),R.assoc("filteredTableRows",t.tableRows,t);case e.SET_APP_NAME:return t.isVerbose&&console.log(`Reducer SET_APP_NAME appName = ${r.appName}`),R.assoc("appName",r.appName,t);case e.SET_FILTER_GROUP:return t.isVerbose&&console.log(`Reducer SET_FILTER_GROUP filterGroup = ${JSON.stringify(r.filterGroup)}`),s.setFilterGroup(t.appName,Immutable(r.filterGroup)),R.assoc("filterGroup",r.filterGroup,t);case e.SET_TABLE_COLUMNS:return t.isVerbose&&console.log("Reducer SET_TABLE_COLUMNS"),R.assoc("tableColumns",Immutable(r.tableColumns),t);case e.SET_TABLE_ROWS:return t.isVerbose&&console.log("Reducer SET_TABLE_ROWS"),R.pipe(R.assoc("tableRows",Immutable(r.tableRows)),R.assoc("filteredTableRows",Immutable(r.tableRows)))(t);case e.SET_VERBOSE:return console.log(`Reducer SET_VERBOSE isVerbose ? ${r.isVerbose}`),R.assoc("isVerbose",r.isVerbose,t);default:return console.warn(`Reducer.root: Unhandled action type: ${r.type}`),t}},filterTableRows:(e,t)=>{const r=c.selectedFilter(t);return Immutable(R.filter((e=>n.passes(r,e)),e))}};Object.freeze(i);const u={filteredTableRows:e=>e.filteredTableRows,filterGroup:e=>e.filterGroup,tableColumns:e=>e.tableColumns,tableRows:e=>e.tableRows};Object.freeze(u);const m={createColorCell:(e,t)=>ReactDOMFactories.div({style:{backgroundColor:e}},t),createIcon:(e,t,r="auto",o="none")=>ReactDOMFactories.img({key:e,src:e,style:{maxWidth:o,width:r},title:t}),createImageLink:(e,t,r)=>{const o=ReactDOMFactories.img({src:e});return ReactDOMFactories.a({key:e,href:t,title:r,target:"_blank"},o)},createLink:(e,t)=>ReactDOMFactories.a({key:t,href:e,target:"_blank"},t),createSpan:(e,t="red")=>ReactDOMFactories.span({key:e,style:{color:t}},e)};m.US_FORMATTER0=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),m.US_FORMATTER2=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),m.formatNumber=(e,t=m.US_FORMATTER0)=>R.isNil(e)?void 0:t.format(e),m.parseFloat=e=>R.isNil(e)||"string"!=typeof e?e:parseFloat(e),m.parseInt=e=>R.isNil(e)||"string"!=typeof e?e:parseInt(e,10),Object.freeze(m);const p={determineCell:(e,t)=>t[`frt-cell-${e.key}`]||p.determineValue(e,t),determineValue:(e,t)=>t[`frt-value-${e.key}`]||t[e.key],tableColumn:(e,t)=>{const r=R.filter((e=>e.key===t),e);return r.length>0?r[0]:void 0}};Object.freeze(p);const{ClauseType:d}=FilterJS,{ReactUtilities:b}=ReactComponent;class T extends React.PureComponent{createRow(e,t){const{tableColumns:r}=this.props,o=R.map((t=>{const r=((e,t)=>e.type===d.BOOLEAN?!0===t[e.key]?"true":!1===t[e.key]?"false":void 0:p.determineValue(e,t))(t,e),o=p.determineCell(t,e);return React.createElement(Reactable.Td,{key:t.key+e.id,className:t.className,column:t.key,value:r},void 0===o?"":o)}),r);return React.createElement(Reactable.Tr,{key:t},o)}createTable(e){const{columnToChecked:t,tableColumns:r}=this.props,o=((e,t)=>R.reduce(((t,r)=>{if(e[r.key]){const e=(e,t)=>{if(["cellFunction","convertFunction","isShown","valueFunction"].includes(t))return e;const o=r[t];return R.assoc(t,o,e)},o=R.reduce(e,{},Object.keys(r));return R.append(o,t)}return t}),[],t))(t,r),s=R.map((e=>this.createRow(e,e.id||e.name)),e);return React.createElement(Reactable.Table,{className:"frt-table",columns:o,sortable:!0},s)}render(){const{rowData:e}=this.props,t=`Row Count: ${e.length}`,r=this.createTable(e),o=[b.createRow(b.createCell(t,"top","frt-rowCount"),"topRow"),b.createRow(b.createCell(r),"tableRow"),b.createRow(b.createCell(t,"bottom","frt-rowCount"),"bottomRow")];return b.createTable(o)}}T.propTypes={columnToChecked:PropTypes.shape().isRequired,rowData:PropTypes.arrayOf(PropTypes.shape()).isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired};var f=ReactRedux.connect((e=>({columnToChecked:e.columnToChecked,rowData:e.filteredTableRows,tableColumns:e.tableColumns})))(T);const{FilterGroup:C,FilterGroupUI:h}=FilterJS;var E=ReactRedux.connect((e=>{const{filterGroup:t,tableColumns:r}=e;let o;o=t&&!Array.isArray(t)?t:C.default(r);return{initialFilterGroup:o,tableColumns:R.filter((e=>"none"!==e.type),r)}}),(e=>({applyOnClick:()=>{e(t.applyFilters())},onChange:r=>{e(t.setFilterGroup(r))},removeOnClick:()=>{e(t.removeFilters())}})))(h);const{CheckboxPanel:S}=ReactComponent;var y=ReactRedux.connect((e=>{const{columnToChecked:t,tableColumns:r}=e,o=(e=>R.reduce(((e,t)=>R.assoc(t.key,t,e)),{},e))(r);return{items:R.map(R.prop("key"),r),labelFunction:e=>o[e].label,selectedItems:(e=>R.reduce(((t,r)=>!0===e[r]?R.append(r,t):t),[],Object.keys(e)))(t)}}),(e=>({applyOnClick:r=>{const o=R.reduce(((e,t)=>R.assoc(t,!0,e)),{},r);e(t.applyShowColumns(o))}})))(S);const{CollapsiblePane:F}=ReactComponent,O=(e,t)=>{if(void 0===t)throw new Error(`Undefined parameter: ${e}`);if(!Array.isArray(t))throw new Error(`Parameter not an array: ${e}`)};class w{constructor(e,r,l,a,n,c){O("tableColumns",e),O("tableRows",r);let u=s.getColumnToChecked(l);0===Object.keys(u).length&&(u=(e=>R.reduce(((e,t)=>{const r=void 0===t.isShown||t.isShown;return R.assoc(t.key,r,e)}),{},e))(e));const m=R.pipe((e=>t=>{const r=R.reduce(((e,t)=>R.assoc(t.key,t,e)),{},e);return R.map((e=>{const t=Object.keys(e);return R.reduce(((t,o)=>{let s=e[o];const l=r[o];return l&&l.convertFunction&&(s=l.convertFunction(e)),R.assoc(o,s,t)}),{},t)}),t)})(e),(e=>t=>R.map((t=>R.reduce(((e,r)=>{if(r.valueFunction){const o=r.valueFunction(t);return R.assoc(`frt-value-${r.key}`,o,e)}return e}),t,e)),t))(e),(e=>t=>R.map((t=>R.reduce(((e,r)=>{if(r.cellFunction){const o=r.cellFunction(t);return R.assoc(`frt-cell-${r.key}`,o,e)}return e}),t,e)),t))(e))(r);this.store=Redux.createStore(i.root),this.store.dispatch(t.setTableColumns(e)),this.store.dispatch(t.applyShowColumns(u)),this.store.dispatch(t.setTableRows(m)),this.store.dispatch(t.setAppName(l)),this.store.dispatch(t.setVerbose(c));const p=s.getFilterGroup(l);if(this.store.dispatch(t.setFilterGroup(p)),a){const e=e=>e.filteredTableRows;o.observeStore(this.store,e,a)}if(n){const e=e=>e.columnToChecked;o.observeStore(this.store,e,n)}}filteredTableRows(){return u.filteredTableRows(this.store.getState())}filterElement(){const e=React.createElement(E);return React.createElement(ReactRedux.Provider,{key:"FRTFilterProvider",store:this.store},e)}filterPanel(e="Filters",t="bg-light-gray ma1",r="b f5 ph1 pt1 tl"){const o=this.filterElement();return React.createElement(F,{className:t,header:e,element:o,headerClass:r,isExpanded:!1})}showColumnsElement(){const e=React.createElement(y);return React.createElement(ReactRedux.Provider,{key:"FRTShowColumnsProvider",store:this.store},e)}showColumnsPanel(e="Columns",t="bg-light-gray ma1",r="b f5 ph1 pt1 tl"){const o=this.showColumnsElement();return React.createElement(F,{className:t,header:e,element:o,headerClass:r,isExpanded:!1})}tableElement(){const e=React.createElement(f);return React.createElement(ReactRedux.Provider,{key:"FRTTableProvider",store:this.store},e)}}return w.ColumnUtilities=m,w}));
