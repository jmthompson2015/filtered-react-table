!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FilteredReactTable=t()}(this,function(){"use strict";const e={APPLY_FILTERS:"applyFilters",REMOVE_FILTERS:"removeFilters",SET_APP_NAME:"setAppName",SET_FILTERS:"setFilters",SET_TABLE_COLUMNS:"setTableColumns",SET_TABLE_ROWS:"setTableRows",SET_VERBOSE:"setVerbose"};Object.freeze(e);const t={},r=(e,...t)=>(...r)=>{const s={type:e};return t.forEach((e,n)=>{s[t[n]]=r[n]}),s};t.applyFilters=r(e.APPLY_FILTERS),t.removeFilters=r(e.REMOVE_FILTERS),t.setAppName=r(e.SET_APP_NAME,"appName"),t.setFilters=r(e.SET_FILTERS,"filters"),t.setTableColumns=r(e.SET_TABLE_COLUMNS,"tableColumns"),t.setTableRows=r(e.SET_TABLE_ROWS,"tableRows"),t.setVerbose=r(e.SET_VERBOSE,"isVerbose"),Object.freeze(t);const s={observeStore:(e,t,r)=>{let s;const n=()=>{const n=t(e.getState());n!==s&&(s=n,r(n))},o=e.subscribe(n);return n(),o}};Object.freeze(s);const n={},o=e=>{const t=localStorage.getItem(e);return void 0!==t?JSON.parse(t):{}};n.getFilters=(e=>{const t=o(e);return void 0!==t&&void 0!==t.filters?Immutable(t.filters):Immutable([])}),n.setFilters=((e,t)=>{const r=o(e),s=R.merge(r,{filters:t});localStorage.setItem(e,JSON.stringify(s))}),Object.freeze(n);const a={create:({appName:e="FilteredReactTable",filteredTableRows:t=[],filters:r=[],isVerbose:s=!1,tableColumns:n=[],tableRows:o=[]}={})=>Immutable({appName:e,filteredTableRows:t,filters:r,isVerbose:s,tableColumns:n,tableRows:o})};Object.freeze(a);const l={IS_TRUE:"bfoIsTrue",IS_FALSE:"bfoIsFalse",properties:{bfoIsTrue:{label:"is true",compareFunction:e=>!0===e,key:"bfoIsTrue"},bfoIsFalse:{label:"is false",compareFunction:e=>!1===e,key:"bfoIsFalse"}}};Object.freeze(l);const i={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",properties:{boolean:{name:"Boolean",key:"boolean"},number:{name:"Number",key:"number"},string:{name:"String",key:"string"}}};Object.freeze(i);const c={IS:"nfoIs",IS_NOT:"nfoIsNot",IS_GREATER_THAN:"nfoIsGreaterThan",IS_LESS_THAN:"nfoIsLessThan",IS_IN_THE_RANGE:"nfoIsInTheRange",properties:{nfoIs:{label:"is",compareFunction:(e,t)=>e===t,key:"nfoIs"},nfoIsNot:{label:"is not",compareFunction:(e,t)=>e!==t,key:"nfoIsNot"},nfoIsGreaterThan:{label:"is greater than",compareFunction:(e,t)=>e>t,key:"nfoIsGreaterThan"},nfoIsLessThan:{label:"is less than",compareFunction:(e,t)=>e<t,key:"nfoIsLessThan"},nfoIsInTheRange:{label:"is in the range",compareFunction:(e,t,r)=>t<=e&&e<=r,key:"nfoIsInTheRange"}}};Object.freeze(c);const u={CONTAINS:"sfoContains",DOES_NOT_CONTAIN:"sfoDoesNotContain",IS:"sfoIs",IS_NOT:"sfoIsNot",BEGINS_WITH:"sfoBeginsWith",ENDS_WITH:"sfoEndsWith"};u.properties={sfoContains:{label:"contains",compareFunction:(e,t)=>{const r=Array.isArray(e)?e.join(" "):e;return void 0!==r&&r.includes(t)},key:"sfoContains"},sfoDoesNotContain:{label:"does not contain",compareFunction:(e,t)=>{const r=Array.isArray(e)?e.join(" "):e;return void 0!==r&&!r.includes(t)},key:"sfoDoesNotContain"},sfoIs:{label:"is",compareFunction:(e,t)=>{return(Array.isArray(e)?e.join(" "):e)===t},key:"sfoIs"},sfoIsNot:{label:"is not",compareFunction:(e,t)=>{return(Array.isArray(e)?e.join(" "):e)!==t},key:"sfoIsNot"},sfoBeginsWith:{label:"begins with",compareFunction:(e,t)=>{const r=Array.isArray(e)?e.join(" "):e;return void 0!==r&&r.startsWith(t)},key:"sfoBeginsWith"},sfoEndsWith:{label:"ends with",compareFunction:(e,t)=>{const r=Array.isArray(e)?e.join(" "):e;return void 0!==r&&r.endsWith(t)},key:"sfoEndsWith"}},Object.freeze(u);const p={determineCell:(e,t)=>t[`frt-cell-${e.key}`]||p.determineValue(e,t),determineValue:(e,t)=>t[`frt-value-${e.key}`]||t[e.key],tableColumn:(e,t)=>{const r=R.filter(e=>e.key===t,e);return r.length>0?r[0]:void 0}};Object.freeze(p);const d={},h=e=>l.properties[e]||c.properties[e]||u.properties[e];d.create=(({columnKey:e,operatorKey:t,rhs:r,rhs2:s})=>Immutable({columnKey:e,operatorKey:t,rhs:r,rhs2:s})),d.isBooleanFilter=(e=>void 0!==e&&Object.keys(l.properties).includes(e.operatorKey)),d.isNumberFilter=(e=>void 0!==e&&Object.keys(c.properties).includes(e.operatorKey)),d.isStringFilter=(e=>void 0!==e&&Object.keys(u.properties).includes(e.operatorKey)),d.passes=((e,t,r)=>{const s=p.tableColumn(e,t.columnKey);if(void 0===s&&console.warn(`Unknown column for filter.columnKey: ${t.columnKey}`),void 0!==s){const e=p.determineValue(s,r);return(e=>h(e).compareFunction)(t.operatorKey)(e,t.rhs,t.rhs2)}return!1}),d.passesAll=((e,t,r)=>{let s=!0;const n=Object.keys(t);for(let o=0;o<n.length;o+=1){const a=t[n[o]];if(!d.passes(e,a,r)){s=!1;break}}return s}),d.toString=(e=>{const t=h(e.operatorKey).label;if(d.isBooleanFilter(e))return`Filter (${e.columnKey} ${t})`;if(d.isStringFilter(e))return`Filter (${e.columnKey} ${t} "${e.rhs}")`;const r=e.rhs2?` ${e.rhs}`:"";return`Filter (${e.columnKey} ${t} ${e.rhs}${r})`}),d.typeKey=(e=>{let t;return d.isBooleanFilter(e)?t=i.BOOLEAN:d.isNumberFilter(e)?t=i.NUMBER:d.isStringFilter(e)&&(t=i.STRING),t}),Object.freeze(d);const b={root:(t,r)=>{if(void 0===t)return a.create();let s;switch(r.type){case e.APPLY_FILTERS:return t.isVerbose&&console.log("Reducer APPLY_FILTERS"),s=b.filterTableRows(t.tableColumns,t.tableRows,t.filters),R.assoc("filteredTableRows",s,t);case e.REMOVE_FILTERS:return t.isVerbose&&console.log("Reducer REMOVE_FILTERS"),R.assoc("filteredTableRows",t.tableRows,t);case e.SET_APP_NAME:return t.isVerbose&&console.log(`Reducer SET_APP_NAME appName = ${r.appName}`),R.assoc("appName",r.appName,t);case e.SET_FILTERS:return t.isVerbose&&console.log("Reducer SET_FILTERS"),n.setFilters(t.appName,Immutable(r.filters)),R.assoc("filters",r.filters,t);case e.SET_TABLE_COLUMNS:return t.isVerbose&&console.log("Reducer SET_TABLE_COLUMNS"),R.assoc("tableColumns",Immutable(r.tableColumns),t);case e.SET_TABLE_ROWS:return t.isVerbose&&console.log("Reducer SET_TABLE_ROWS"),R.pipe(R.assoc("tableRows",Immutable(r.tableRows)),R.assoc("filteredTableRows",Immutable(r.tableRows)))(t);case e.SET_VERBOSE:return console.log(`Reducer SET_VERBOSE isVerbose ? ${r.isVerbose}`),R.assoc("isVerbose",r.isVerbose,t);default:return console.warn(`Reducer.root: Unhandled action type: ${r.type}`),t}},filterTableRows:(e,t,r)=>Immutable(R.filter(t=>d.passesAll(e,r,t),t))};Object.freeze(b);const m={filteredTableRows:e=>e.filteredTableRows,filters:e=>e.filters,tableColumns:e=>e.tableColumns,tableRows:e=>e.tableRows};Object.freeze(m);const y={createCell:(e,t,r,s={})=>{const n=R.merge(s,{key:t,className:r,style:{display:"table-cell"}});return ReactDOMFactories.div(n,e)},createRow:(e,t,r,s={})=>{const n=R.merge(s,{key:t,className:r,style:{display:"table-row"}});return ReactDOMFactories.div(n,e)},createTable:(e,t,r,s={})=>{const n=R.merge(s,{key:t,className:r,style:{display:"table"}});return ReactDOMFactories.div(n,e)}},f=(e,t)=>e.type===i.BOOLEAN?!0===t[e.key]?"true":!1===t[e.key]?"false":void 0:p.determineValue(e,t),T=e=>{return R.reduce((e,t)=>{if(!t.isHidden){const r=(e,r)=>{if(["cellFunction","convertFunction","valueFunction"].includes(r))return e;const s=t[r];return R.assoc(r,s,e)},s=R.reduce(r,{},Object.keys(t));return R.append(s,e)}return e},[],e)};class C extends React.PureComponent{constructor(e){super(e),this.Table=React.createFactory(Reactable.Table),this.Tr=React.createFactory(Reactable.Tr),this.Td=React.createFactory(Reactable.Td)}createRow(e,t){const{tableColumns:r}=this.props,s=R.map(t=>{const r=f(t,e),s=p.determineCell(t,e);return this.Td({key:t.key+e.id,className:t.className,column:t.key,value:r},void 0===s?"":s)},r);return this.Tr({key:t},s)}createTable(e){const{tableColumns:t}=this.props,r=T(t),s=R.map(e=>this.createRow(e,e.id||e.name),e);return this.Table({className:"frt-table",columns:r,sortable:!0},s)}render(){const{rowData:e}=this.props,t=`Row Count: ${e.length}`,r=this.createTable(e),s=[y.createRow(y.createCell(t,"top","frt-rowCount"),"topRow"),y.createRow(y.createCell(r),"tableRow"),y.createRow(y.createCell(t,"bottom","frt-rowCount"),"bottomRow")];return y.createTable(s)}}C.propTypes={rowData:PropTypes.arrayOf(PropTypes.shape()).isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired};var F=ReactRedux.connect(e=>({rowData:e.filteredTableRows,tableColumns:e.tableColumns}))(C);const k={findByName:(e,t)=>k.findByProp("name",e,t),findByProp:(e,t,r)=>R.find(R.propEq(e,t),k.values(r)),keys:e=>Object.keys(e.properties),values:e=>Object.values(e.properties)};Object.freeze(k);class E extends React.PureComponent{constructor(e){super(e);const{initialValue:t}=this.props;this.state={value:t},this.handleBlur=this.handleBlurFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this)}handleBlurFunction(){const{onBlur:e}=this.props,{value:t}=this.state;e(Number(t))}handleChangeFunction(e){const{value:t}=e.target,r=Number(t);this.setState({value:r})}render(){const{className:e,id:t,initialValue:r,max:s,min:n,step:o}=this.props;return ReactDOMFactories.input({id:t,type:"number",className:e,defaultValue:r,max:s,min:n,step:o,onBlur:this.handleBlur,onChange:this.handleChange})}}E.propTypes={onBlur:PropTypes.func.isRequired,id:PropTypes.string,className:PropTypes.string,initialValue:PropTypes.number,max:PropTypes.number,min:PropTypes.number,step:PropTypes.number},E.defaultProps={id:"numberInput",className:void 0,initialValue:0,max:void 0,min:void 0,step:void 0};const O=(e,t)=>ReactDOMFactories.option({key:e,value:e},t);class v extends React.PureComponent{constructor(e){super(e),this.handleChange=this.handleChangeFunction.bind(this)}handleChangeFunction(){const{id:e,onChange:t}=this.props,r=document.getElementById(e);t(r.options[r.selectedIndex].value)}render(){const{id:e,values:t,initialValue:r}=this.props,s=R.map(e=>O(e.key,e.label),t);return ReactDOMFactories.select({id:e,defaultValue:r,onChange:this.handleChange},s)}}v.propTypes={values:PropTypes.arrayOf(PropTypes.shape()).isRequired,onChange:PropTypes.func.isRequired,id:PropTypes.string,initialValue:PropTypes.string},v.defaultProps={id:"select",initialValue:void 0};class g extends React.PureComponent{constructor(e){super(e);const{initialValue:t}=this.props;this.state={value:t},this.handleBlur=this.handleBlurFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this)}handleBlurFunction(){const{onBlur:e}=this.props,{value:t}=this.state;e(t)}handleChangeFunction(e){const{value:t}=e.target;this.setState({value:t})}render(){const{className:e,id:t,initialValue:r}=this.props;return ReactDOMFactories.input({id:t,type:"text",className:e,defaultValue:r,onBlur:this.handleBlur,onChange:this.handleChange})}}g.propTypes={onBlur:PropTypes.func.isRequired,id:PropTypes.string,className:PropTypes.string,initialValue:PropTypes.string},g.defaultProps={id:"stringInput",className:void 0,initialValue:""};const N=e=>"string"==typeof e?Number(e):e,S=(e,t)=>{const r=Object.values(e)[0].key,s=t&&t.columnKey||r;return p.tableColumn(e,s)},w=(e,t)=>{const r=document.getElementById(`columnSelect${t}`).value;return p.tableColumn(e,r)},I=e=>ReactDOMFactories.button({onClick:e},"+"),B=(e,t,r,s,n)=>React.createElement(v,{id:`columnSelect${r}`,values:e,initialValue:s.key,onChange:n}),P=e=>y.createCell("",e),A=e=>{let t;switch(e.type){case i.BOOLEAN:t=l;break;case i.NUMBER:t=c;break;case i.STRING:case void 0:t=u;break;default:throw new Error(`Unknown column.type: ${e.type}`)}return k.values(t)},_=(e,t,r,s)=>{const n=A(r);return React.createElement(v,{id:`operatorSelect${t}`,values:n,initialValue:e?e.operatorKey:void 0,onChange:s})},$=(e,t,r,s,n,o)=>{const a=d.typeKey(e);let l;switch(a){case i.BOOLEAN:l=(e=>[P(`rhsBooleanField1${e}`),P(`rhsBooleanField2${e}`),P(`rhsBooleanField3${e}`)])(t);break;case i.NUMBER:l=((e,t,r,s,n,o)=>{const a=`rhsField${t}`,l=e?N(e.rhs):void 0;if(e.operatorKey===c.IS_IN_THE_RANGE){const i=e?N(e.rhs2):void 0;return[y.createCell(React.createElement(E,{id:a,className:"field",initialValue:l,max:n,min:s,step:o,onBlur:r}),`rhs1NumberField1${t}`),y.createCell(ReactDOMFactories.span({style:{paddingLeft:3,paddingRight:3}},"to"),`toField${t}`),y.createCell(React.createElement(E,{id:`rhs2Field${t}`,className:"field",initialValue:i,max:n,min:s,step:o,onBlur:r}),`rhs2NumberField3${t}`)]}return[y.createCell(React.createElement(E,{id:a,className:"field",initialValue:l,max:n,min:s,step:o,onBlur:r}),`rhsNumberField1${t}`),P(`rhsNumberField2${t}`),P(`rhsNumberField3${t}`)]})(e,t,r,s,n,o);break;case i.STRING:l=((e,t,r)=>{const s=`rhsField${t}`;return[y.createCell(React.createElement(g,{id:s,className:"field",initialValue:e?e.rhs:void 0,onBlur:r}),`rhsStringField1${t}`),P(`rhsStringField2${t}`),P(`rhsStringField3${t}`)]})(e,t,r);break;default:throw new Error(`Unknown filter typeKey: ${a}`)}return l},V=(e,t)=>ReactDOMFactories.button({hidden:e,onClick:t},"-"),L=(e,t)=>{const r=document.getElementById(`operatorSelect${t}`).value,s=A(e);return R.map(e=>e.key,s).includes(r)?r:s[0].key},K=e=>{const t=document.getElementById(`rhsField${e}`);return t?t.value:void 0},j=e=>{const t=document.getElementById(`rhs2Field${e}`);return t?t.value:void 0};class M extends React.PureComponent{constructor(e){super(e),this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}handleAddOnClickFunction(){const{addOnClick:e,index:t}=this.props;e(t)}handleChangeFunction(){const{index:e,onChange:t,tableColumns:r}=this.props,s=w(r,e),n=L(s,e),o=K(e),a=j(e);let l;switch(s.type){case i.BOOLEAN:l=d.create({columnKey:s.key,operatorKey:n});break;case i.NUMBER:l=d.create({columnKey:s.key,operatorKey:n,rhs:N(o),rhs2:N(a)});break;case i.STRING:case void 0:l=d.create({columnKey:s.key,operatorKey:n,rhs:o});break;default:throw new Error(`Unknown column.type: ${s.type}`)}t(l,e)}handleRemoveOnClickFunction(){const{removeOnClick:e,index:t}=this.props;e(t)}render(){const{filter:e,index:t,isRemoveHidden:r,tableColumns:s}=this.props,n=S(s,e),o=[y.createCell(B(s,e,t,n,this.handleChange),`${n.key}ColumnSelectCell${t}`),y.createCell(_(e,t,n,this.handleChange),`${n.key}OperatorSelectCell${t}`),$(e,t,this.handleChange,n.min,n.max,n.step),y.createCell(V(r,this.handleRemoveOnClick),`removeButtonCell${t}`),y.createCell(I(this.handleAddOnClick),`addButtonCell${t}`)];return y.createRow(o,`${n.key}FilterRow${t}`,"frt-filter-row")}}M.propTypes={onChange:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,addOnClick:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired,filter:PropTypes.shape(),index:PropTypes.number,isRemoveHidden:PropTypes.bool},M.defaultProps={filter:void 0,index:void 0,isRemoveHidden:!1};class x extends React.PureComponent{constructor(e){super(e),this.handleAddOnClick=this.handleAddOnClickFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this),this.handleRemoveOnClick=this.handleRemoveOnClickFunction.bind(this)}createButtonTable(){const{applyOnClick:e,removeOnClick:t}=this.props,r=ReactDOMFactories.button({onClick:t},"Remove"),s=ReactDOMFactories.button({onClick:e},"Apply"),n=[y.createCell(r,"unfilterButton","button"),y.createCell(s,"filterButton","button")],o=y.createRow(n,"button-row");return y.createTable(o,"buttonTable","buttons")}createTable(){const e=[],{filters:t,tableColumns:r}=this.props,{handleAddOnClick:s,handleChange:n,handleRemoveOnClick:o}=this;if(0===t.length){const e=r[0];let s;switch(e.type){case i.BOOLEAN:s=d.create({columnKey:e.key,operatorKey:Object.keys(l.properties)[0]});break;case i.NUMBER:s=d.create({columnKey:e.key,operatorKey:Object.keys(c.properties)[0],rhs:0});break;case i.STRING:case void 0:s=d.create({columnKey:e.key,operatorKey:Object.keys(u.properties)[0],rhs:""});break;default:throw new Error(`Unknown firstColumn.type: ${e.type}`)}t.push(s)}for(let a=0;a<t.length;a+=1){const l=t[a],i=1===t.length&&0===a,c=React.createElement(M,{key:`filterRow${a}`,filter:l,index:a,isRemoveHidden:i,tableColumns:r,onChange:n,addOnClick:s,removeOnClick:o});e.push(c)}return y.createTable(e,"filterTable")}handleAddOnClickFunction(e){const{filters:t,onChange:r,tableColumns:s}=this.props,n=s[0];let o;switch(n.type){case i.BOOLEAN:o=d.create({columnKey:n.key,operatorKey:Object.keys(l.properties)[0]});break;case i.NUMBER:o=d.create({columnKey:n.key,operatorKey:Object.keys(c.properties)[0],rhs:0});break;case i.STRING:case void 0:o=d.create({columnKey:n.key,operatorKey:Object.keys(u.properties)[0],rhs:""});break;default:throw new Error(`Unknown firstColumn.type: ${n.type}`)}r(R.insert(e+1,o,t))}handleChangeFunction(e,t){const{filters:r,onChange:s}=this.props;s(R.update(t,e,r))}handleRemoveOnClickFunction(e){const{filters:t,onChange:r}=this.props;r(R.remove(e,1,t))}render(){const e=y.createCell(this.createTable(),"filterTable","inner-table"),t=y.createRow(e,"filterTableCells"),r=y.createTable(t,"filterTableRow"),s=y.createCell("Filter","filterTitle","title"),n=y.createCell(r,"filterTable"),o=y.createCell(this.createButtonTable(),"buttonTable","button-panel"),a=[y.createRow(s,"filterTitleRow"),y.createRow(n,"filterTablesRow"),y.createRow(o,"buttonRow")];return y.createTable(a,"filterTable","frt-filter")}}x.propTypes={filters:PropTypes.arrayOf(PropTypes.shape()).isRequired,onChange:PropTypes.func.isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,applyOnClick:PropTypes.func.isRequired,removeOnClick:PropTypes.func.isRequired};var D=ReactRedux.connect(e=>{const{filters:t,tableColumns:r}=e;return{filters:t,tableColumns:R.filter(e=>"none"!==e.type,r)}},e=>({applyOnClick:()=>{e(t.applyFilters())},onChange:r=>{e(t.setFilters(r))},removeOnClick:()=>{e(t.removeFilters())}}))(x);const U=e=>t=>{return R.map(t=>{return R.reduce((e,r)=>{const s=r.convertFunction?r.convertFunction(t):t[r.key];return R.assoc(r.key,s,e)},{},e)},t)},q=e=>t=>{return R.map(t=>{return R.reduce((e,r)=>{if(r.cellFunction){const s=r.cellFunction(t);return R.assoc(`frt-cell-${r.key}`,s,e)}return e},t,e)},t)},z=e=>t=>{return R.map(t=>{return R.reduce((e,r)=>{if(r.valueFunction){const s=r.valueFunction(t);return R.assoc(`frt-value-${r.key}`,s,e)}return e},t,e)},t)},G=(e,t)=>{if(void 0===t)throw new Error(`Undefined parameter: ${e}`);if(!Array.isArray(t))throw new Error(`Parameter not an array: ${e}`)};return class{constructor(e,r,o,a,l,i){G("tableColumns",e),G("tableRows",r);const c=R.pipe(U(e),z(e),q(e))(r);this.store=Redux.createStore(b.root),this.store.dispatch(t.setTableColumns(e)),this.store.dispatch(t.setTableRows(c)),this.store.dispatch(t.setAppName(o)),this.store.dispatch(t.setVerbose(i));const u=n.getFilters(o);if(this.store.dispatch(t.setFilters(u)),a){const e=e=>e.tableColumns;s.observeStore(this.store,e,a)}if(l){const e=e=>e.filteredTableRows;s.observeStore(this.store,e,l)}}filteredTableRows(){return m.filteredTableRows(this.store.getState())}filterElement(){const e=React.createElement(D);return React.createElement(ReactRedux.Provider,{key:"FRTFilterProvider",store:this.store},e)}tableElement(){const e=React.createElement(F);return React.createElement(ReactRedux.Provider,{key:"FRTTableProvider",store:this.store},e)}}});
