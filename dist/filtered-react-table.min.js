!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FilteredReactTable=t()}(this,(function(){"use strict";const e={APPLY_FILTERS:"applyFilters",APPLY_SHOW_COLUMNS:"applyShowColumns",REMOVE_FILTERS:"removeFilters",SET_APP_NAME:"setAppName",SET_FILTER_GROUP:"setFilterGroup",SET_TABLE_COLUMNS:"setTableColumns",SET_TABLE_ROWS:"setTableRows",SET_VERBOSE:"setVerbose"};Object.freeze(e);const t={},o=(e,...t)=>(...o)=>{const r={type:e};return t.forEach(((e,s)=>{r[t[s]]=o[s]})),r};t.applyFilters=o(e.APPLY_FILTERS),t.applyShowColumns=o(e.APPLY_SHOW_COLUMNS,"columnToChecked"),t.removeFilters=o(e.REMOVE_FILTERS),t.setAppName=o(e.SET_APP_NAME,"appName"),t.setFilterGroup=o(e.SET_FILTER_GROUP,"filterGroup"),t.setTableColumns=o(e.SET_TABLE_COLUMNS,"tableColumns"),t.setTableRows=o(e.SET_TABLE_ROWS,"tableRows"),t.setVerbose=o(e.SET_VERBOSE,"isVerbose"),Object.freeze(t);const r={observeStore:(e,t,o)=>{let r;const s=()=>{const s=t(e.getState());s!==r&&(r=s,o(s))},l=e.subscribe(s);return s(),l}};Object.freeze(r);const s={},l=e=>{const t=localStorage.getItem(e);return void 0!==t?JSON.parse(t):{}};s.getColumnToChecked=e=>{const t=l(e);return t&&t.columnToChecked?Immutable(t.columnToChecked):Immutable({})},s.setColumnToChecked=(e,t)=>{const o=l(e),r=R.merge(o,{columnToChecked:t});localStorage.setItem(e,JSON.stringify(r))},s.getFilterGroup=e=>{const t=l(e);return t&&t.filterGroup?Immutable(t.filterGroup):Immutable([])},s.setFilterGroup=(e,t)=>{const o=l(e),r=R.merge(o,{filterGroup:t});localStorage.setItem(e,JSON.stringify(r))},Object.freeze(s);const a={create:({appName:e="FilteredReactTable",columnToChecked:t={},filteredTableRows:o=[],filterGroup:r,isVerbose:s=!1,tableColumns:l=[],tableRows:a=[]}={})=>Immutable({appName:e,columnToChecked:t,filteredTableRows:o,filterGroup:r,isVerbose:s,tableColumns:l,tableRows:a})};Object.freeze(a);const{Filter:n,FilterGroup:c}=FilterJS,i={root:(t,o)=>{if(void 0===t)return a.create();let r;switch(o.type){case e.APPLY_FILTERS:return t.isVerbose&&console.log("Reducer APPLY_FILTERS"),r=i.filterTableRows(t.tableRows,t.filterGroup),R.assoc("filteredTableRows",r,t);case e.APPLY_SHOW_COLUMNS:return t.isVerbose&&console.log(`Reducer APPLY_SHOW_COLUMNS columnToChecked = ${JSON.stringify(o.columnToChecked)}`),s.setColumnToChecked(t.appName,Immutable(o.columnToChecked)),R.assoc("columnToChecked",o.columnToChecked,t);case e.REMOVE_FILTERS:return t.isVerbose&&console.log("Reducer REMOVE_FILTERS"),R.assoc("filteredTableRows",t.tableRows,t);case e.SET_APP_NAME:return t.isVerbose&&console.log(`Reducer SET_APP_NAME appName = ${o.appName}`),R.assoc("appName",o.appName,t);case e.SET_FILTER_GROUP:return t.isVerbose&&console.log(`Reducer SET_FILTER_GROUP filterGroup = ${JSON.stringify(o.filterGroup)}`),s.setFilterGroup(t.appName,Immutable(o.filterGroup)),R.assoc("filterGroup",o.filterGroup,t);case e.SET_TABLE_COLUMNS:return t.isVerbose&&console.log("Reducer SET_TABLE_COLUMNS"),R.assoc("tableColumns",Immutable(o.tableColumns),t);case e.SET_TABLE_ROWS:return t.isVerbose&&console.log("Reducer SET_TABLE_ROWS"),R.pipe(R.assoc("tableRows",Immutable(o.tableRows)),R.assoc("filteredTableRows",Immutable(o.tableRows)))(t);case e.SET_VERBOSE:return console.log(`Reducer SET_VERBOSE isVerbose ? ${o.isVerbose}`),R.assoc("isVerbose",o.isVerbose,t);default:return console.warn(`Reducer.root: Unhandled action type: ${o.type}`),t}},filterTableRows:(e,t)=>{const o=c.selectedFilter(t);return Immutable(R.filter((e=>n.passes(o,e)),e))}};Object.freeze(i);const u={filteredTableRows:e=>e.filteredTableRows,filterGroup:e=>e.filterGroup,tableColumns:e=>e.tableColumns,tableRows:e=>e.tableRows};Object.freeze(u);const m={createColorCell:(e,t)=>ReactDOMFactories.div({style:{backgroundColor:e}},t),createIcon:(e,t,o="auto",r="none")=>ReactDOMFactories.img({key:e,src:e,style:{maxWidth:r,width:o},title:t}),createImageLink:(e,t,o)=>{const r=ReactDOMFactories.img({src:e});return ReactDOMFactories.a({key:e,href:t,title:o,target:"_blank"},r)},createLink:(e,t)=>ReactDOMFactories.a({key:t,href:e,target:"_blank"},t),createSpan:(e,t="red")=>ReactDOMFactories.span({key:e,style:{color:t}},e)};m.US_FORMATTER0=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}),m.US_FORMATTER2=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),m.formatNumber=(e,t=m.US_FORMATTER0)=>R.isNil(e)?void 0:t.format(e),m.parseFloat=e=>R.isNil(e)||"string"!=typeof e?e:parseFloat(e),m.parseInt=e=>R.isNil(e)||"string"!=typeof e?e:parseInt(e,10),Object.freeze(m);const p={determineCell:(e,t)=>t[`frt-cell-${e.key}`]||p.determineValue(e,t),determineValue:(e,t)=>t[`frt-value-${e.key}`]||t[e.key],tableColumn:(e,t)=>{const o=R.filter((e=>e.key===t),e);return o.length>0?o[0]:void 0}};Object.freeze(p);const{ClauseType:b}=FilterJS,{ReactUtilities:d}=ReactComponent;class T extends React.PureComponent{createRow(e,t){const{rowClass:o,tableColumns:r}=this.props,s=R.map((t=>{const o=((e,t)=>e.type===b.BOOLEAN?!0===t[e.key]?"true":!1===t[e.key]?"false":void 0:p.determineValue(e,t))(t,e),r=p.determineCell(t,e);return React.createElement(Reactable.Td,{key:t.key+e.id,className:t.className,column:t.key,value:o},void 0===r?"":r)}),r);return React.createElement(Reactable.Tr,{key:t,className:o},s)}createTable(e){const{columnToChecked:t,dataTableClass:o,tableColumns:r}=this.props,s=((e,t)=>R.reduce(((t,o)=>{if(e[o.key]){const e=(e,t)=>{if(["cellFunction","convertFunction","isShown","valueFunction"].includes(t))return e;const r=o[t];return R.assoc(t,r,e)},r=R.reduce(e,{},Object.keys(o));return R.append(r,t)}return t}),[],t))(t,r),l=R.map((e=>this.createRow(e,e.id||e.name)),e);return React.createElement(Reactable.Table,{className:`frt-table ${o}`,columns:s,sortable:!0},l)}render(){const{className:e,rowCountClass:t,rowData:o}=this.props,r=`Row Count: ${o.length}`,s=this.createTable(o),l=[d.createRow(d.createCell(r,"top",t),"topRow"),d.createRow(d.createCell(s),"tableRow"),d.createRow(d.createCell(r,"bottom",t),"bottomRow")];return d.createTable(l,"dataTablePanel",e)}}T.propTypes={columnToChecked:PropTypes.shape().isRequired,rowData:PropTypes.arrayOf(PropTypes.shape()).isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,className:PropTypes.string,dataTableClass:PropTypes.string,rowClass:PropTypes.string,rowCountClass:PropTypes.string},T.defaultProps={className:void 0,dataTableClass:"bg-white collapse f6 tc",rowClass:"striped--white-smoke",rowCountClass:"f6 tl"};var C=ReactRedux.connect((e=>({columnToChecked:e.columnToChecked,rowData:e.filteredTableRows,tableColumns:e.tableColumns})))(T);const{FilterGroup:f,FilterGroupUI:h}=FilterJS;var E=ReactRedux.connect((e=>{const{filterGroup:t,tableColumns:o}=e;let r;r=t&&!Array.isArray(t)?t:f.default(o);return{className:"f7",initialFilterGroup:r,tableColumns:R.filter((e=>"none"!==e.type),o)}}),(e=>({applyOnClick:()=>{e(t.applyFilters())},onChange:o=>{e(t.setFilterGroup(o))},removeOnClick:()=>{e(t.removeFilters())}})))(h);const{CheckboxPanel:S}=ReactComponent;var y=ReactRedux.connect((e=>{const{columnToChecked:t,tableColumns:o}=e,r=(e=>R.reduce(((e,t)=>R.assoc(t.key,t,e)),{},e))(o);return{className:"f7",items:R.map(R.prop("key"),o),labelFunction:e=>r[e].label,selectedItems:(e=>R.reduce(((t,o)=>!0===e[o]?R.append(o,t):t),[],Object.keys(e)))(t),useSelectButtons:!0}}),(e=>({applyOnClick:o=>{const r=R.reduce(((e,t)=>R.assoc(t,!0,e)),{},o);e(t.applyShowColumns(r))}})))(S);const{CollapsiblePane:F}=ReactComponent,w=(e,t)=>{if(void 0===t)throw new Error(`Undefined parameter: ${e}`);if(!Array.isArray(t))throw new Error(`Parameter not an array: ${e}`)};class O{constructor(e,o,l,a,n,c){w("tableColumns",e),w("tableRows",o);let u=s.getColumnToChecked(l);0===Object.keys(u).length&&(u=(e=>R.reduce(((e,t)=>{const o=void 0===t.isShown||t.isShown;return R.assoc(t.key,o,e)}),{},e))(e));const m=R.pipe((e=>t=>{const o=R.reduce(((e,t)=>R.assoc(t.key,t,e)),{},e);return R.map((e=>{const t=Object.keys(e);return R.reduce(((t,r)=>{let s=e[r];const l=o[r];return l&&l.convertFunction&&(s=l.convertFunction(e)),R.assoc(r,s,t)}),{},t)}),t)})(e),(e=>t=>R.map((t=>R.reduce(((e,o)=>{if(o.valueFunction){const r=o.valueFunction(t);return R.assoc(`frt-value-${o.key}`,r,e)}return e}),t,e)),t))(e),(e=>t=>R.map((t=>R.reduce(((e,o)=>{if(o.cellFunction){const r=o.cellFunction(t);return R.assoc(`frt-cell-${o.key}`,r,e)}return e}),t,e)),t))(e))(o);this.store=Redux.createStore(i.root),this.store.dispatch(t.setTableColumns(e)),this.store.dispatch(t.applyShowColumns(u)),this.store.dispatch(t.setTableRows(m)),this.store.dispatch(t.setAppName(l)),this.store.dispatch(t.setVerbose(c));const p=s.getFilterGroup(l);if(this.store.dispatch(t.setFilterGroup(p)),a){const e=e=>e.filteredTableRows;r.observeStore(this.store,e,a)}if(n){const e=e=>e.columnToChecked;r.observeStore(this.store,e,n)}}filteredTableRows(){return u.filteredTableRows(this.store.getState())}filterElement(){const e=React.createElement(E);return React.createElement(ReactRedux.Provider,{key:"FRTFilterProvider",store:this.store},e)}filterPanel(e="Filters",t="bg-light-gray ma1",o="b f5 ph1 pt1 tl"){const r=this.filterElement();return React.createElement(F,{className:t,element:r,title:e,titleClass:o})}showColumnsElement(){const e=React.createElement(y);return React.createElement(ReactRedux.Provider,{key:"FRTShowColumnsProvider",store:this.store},e)}showColumnsPanel(e="Columns",t="bg-light-gray ma1",o="b f5 ph1 pt1 tl"){const r=this.showColumnsElement();return React.createElement(F,{className:t,element:r,title:e,titleClass:o})}tableElement(){const e=React.createElement(C);return React.createElement(ReactRedux.Provider,{key:"FRTTableProvider",store:this.store},e)}}return O.ColumnUtilities=m,O}));
