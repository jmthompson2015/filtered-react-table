!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FilteredReactTable=t()}(this,(function(){"use strict";const e={APPLY_FILTERS:"applyFilters",APPLY_SHOW_COLUMNS:"applyShowColumns",REMOVE_FILTERS:"removeFilters",SET_APP_NAME:"setAppName",SET_FILTER_GROUP:"setFilterGroup",SET_TABLE_COLUMNS:"setTableColumns",SET_TABLE_ROWS:"setTableRows",SET_VERBOSE:"setVerbose"};Object.freeze(e);const t={},o=(e,...t)=>(...o)=>{const r={type:e};return t.forEach(((e,s)=>{r[t[s]]=o[s]})),r};t.applyFilters=o(e.APPLY_FILTERS),t.applyShowColumns=o(e.APPLY_SHOW_COLUMNS,"columnToChecked"),t.removeFilters=o(e.REMOVE_FILTERS),t.setAppName=o(e.SET_APP_NAME,"appName"),t.setFilterGroup=o(e.SET_FILTER_GROUP,"filterGroup"),t.setTableColumns=o(e.SET_TABLE_COLUMNS,"tableColumns"),t.setTableRows=o(e.SET_TABLE_ROWS,"tableRows"),t.setVerbose=o(e.SET_VERBOSE,"isVerbose"),Object.freeze(t);const r={observeStore:(e,t,o)=>{let r;const s=()=>{const s=t(e.getState());s!==r&&(r=s,o(s))},l=e.subscribe(s);return s(),l}};Object.freeze(r);const s={},l=e=>{const t=localStorage.getItem(e);return void 0!==t?JSON.parse(t):{}};s.getColumnToChecked=e=>{const t=l(e);return t&&t.columnToChecked?Immutable(t.columnToChecked):Immutable({})},s.setColumnToChecked=(e,t)=>{const o=l(e),r=R.merge(o,{columnToChecked:t});localStorage.setItem(e,JSON.stringify(r))},s.getFilterGroup=e=>{const t=l(e);return t&&t.filterGroup?Immutable(t.filterGroup):Immutable([])},s.setFilterGroup=(e,t)=>{const o=l(e),r=R.merge(o,{filterGroup:t});localStorage.setItem(e,JSON.stringify(r))},Object.freeze(s);const a={create:({appName:e="FilteredReactTable",columnToChecked:t={},filteredTableRows:o=[],filterGroup:r,isVerbose:s=!1,tableColumns:l=[],tableRows:a=[]}={})=>Immutable({appName:e,columnToChecked:t,filteredTableRows:o,filterGroup:r,isVerbose:s,tableColumns:l,tableRows:a})};Object.freeze(a);const{Filter:n,FilterGroup:c}=FilterJS,i={root:(t,o)=>{if(void 0===t)return a.create();let r;switch(o.type){case e.APPLY_FILTERS:return t.isVerbose&&console.log("Reducer APPLY_FILTERS"),r=i.filterTableRows(t.tableRows,t.filterGroup),R.assoc("filteredTableRows",r,t);case e.APPLY_SHOW_COLUMNS:return t.isVerbose&&console.log(`Reducer APPLY_SHOW_COLUMNS columnToChecked = ${JSON.stringify(o.columnToChecked)}`),s.setColumnToChecked(t.appName,Immutable(o.columnToChecked)),R.assoc("columnToChecked",o.columnToChecked,t);case e.REMOVE_FILTERS:return t.isVerbose&&console.log("Reducer REMOVE_FILTERS"),R.assoc("filteredTableRows",t.tableRows,t);case e.SET_APP_NAME:return t.isVerbose&&console.log(`Reducer SET_APP_NAME appName = ${o.appName}`),R.assoc("appName",o.appName,t);case e.SET_FILTER_GROUP:return t.isVerbose&&console.log(`Reducer SET_FILTER_GROUP filterGroup = ${JSON.stringify(o.filterGroup)}`),s.setFilterGroup(t.appName,Immutable(o.filterGroup)),R.assoc("filterGroup",o.filterGroup,t);case e.SET_TABLE_COLUMNS:return t.isVerbose&&console.log("Reducer SET_TABLE_COLUMNS"),R.assoc("tableColumns",Immutable(o.tableColumns),t);case e.SET_TABLE_ROWS:return t.isVerbose&&console.log("Reducer SET_TABLE_ROWS"),R.pipe(R.assoc("tableRows",Immutable(o.tableRows)),R.assoc("filteredTableRows",Immutable(o.tableRows)))(t);case e.SET_VERBOSE:return console.log(`Reducer SET_VERBOSE isVerbose ? ${o.isVerbose}`),R.assoc("isVerbose",o.isVerbose,t);default:return console.warn(`Reducer.root: Unhandled action type: ${o.type}`),t}},filterTableRows:(e,t)=>{const o=c.selectedFilter(t);return Immutable(R.filter((e=>n.passes(o)(e)),e))}};Object.freeze(i);const u={filteredTableRows:e=>e.filteredTableRows,filterGroup:e=>e.filterGroup,tableColumns:e=>e.tableColumns,tableRows:e=>e.tableRows};Object.freeze(u);const p={createCell:(e,t,o,r={})=>{const s=R.merge(r,{key:t,className:o,style:{display:"table-cell"}});return ReactDOMFactories.div(s,e)},createRow:(e,t,o,r={})=>{const s=R.merge(r,{key:t,className:o,style:{display:"table-row"}});return ReactDOMFactories.div(s,e)},createTable:(e,t,o,r={})=>{const s=R.merge(r,{key:t,className:o,style:{display:"table"}});return ReactDOMFactories.div(s,e)}};class d extends React.PureComponent{constructor(e){super(e),this.state={isCollapsed:!0},this.handleChange=this.handleChangeFunction.bind(this)}handleChangeFunction(){const{isCollapsed:e}=this.state;this.setState({isCollapsed:!e})}render(){const{isCollapsed:e}=this.state,{child:t,title:o}=this.props,r=((e,t)=>ReactDOMFactories.span({key:"control",className:"control",onClick:t},e))(e?"▶":"▼",this.handleChange),s=(e=>ReactDOMFactories.span({key:"label",className:"label"},e))(o),l=p.createCell([r,s],"titleCell","title-cell");let a;if(e){const e=p.createRow(l,"titleRow");a=p.createTable(e,"collapsiblePanel","frt-collapsible-panel")}else{const e=(e=>ReactDOMFactories.div({key:"childPanel",className:"child-panel"},e))(t),o=p.createCell(e,"childCell","child-cell"),r=[p.createRow(l,"titleRow"),p.createRow(o,"childRow")];a=p.createTable(r,"collapsiblePanel","frt-collapsible-panel")}return a}}d.propTypes={title:PropTypes.string.isRequired,child:PropTypes.shape().isRequired};const m={BOOLEAN:"boolean",NUMBER:"number",STRING:"string",properties:{boolean:{name:"Boolean",key:"boolean"},number:{name:"Number",key:"number"},string:{name:"String",key:"string"}}};Object.freeze(m);const h={determineCell:(e,t)=>t[`frt-cell-${e.key}`]||h.determineValue(e,t),determineValue:(e,t)=>t[`frt-value-${e.key}`]||t[e.key],tableColumn:(e,t)=>{const o=R.filter((e=>e.key===t),e);return o.length>0?o[0]:void 0}};Object.freeze(h);class b extends React.PureComponent{createRow(e,t){const{tableColumns:o}=this.props,r=R.map((t=>{const o=((e,t)=>e.type===m.BOOLEAN?!0===t[e.key]?"true":!1===t[e.key]?"false":void 0:h.determineValue(e,t))(t,e),r=h.determineCell(t,e);return React.createElement(Reactable.Td,{key:t.key+e.id,className:t.className,column:t.key,value:o},void 0===r?"":r)}),o);return React.createElement(Reactable.Tr,{key:t},r)}createTable(e){const{columnToChecked:t,tableColumns:o}=this.props,r=((e,t)=>R.reduce(((t,o)=>{if(e[o.key]){const e=(e,t)=>{if(["cellFunction","convertFunction","isShown","valueFunction"].includes(t))return e;const r=o[t];return R.assoc(t,r,e)},r=R.reduce(e,{},Object.keys(o));return R.append(r,t)}return t}),[],t))(t,o),s=R.map((e=>this.createRow(e,e.id||e.name)),e);return React.createElement(Reactable.Table,{className:"frt-table",columns:r,sortable:!0},s)}render(){const{rowData:e}=this.props,t=`Row Count: ${e.length}`,o=this.createTable(e),r=[p.createRow(p.createCell(t,"top","frt-rowCount"),"topRow"),p.createRow(p.createCell(o),"tableRow"),p.createRow(p.createCell(t,"bottom","frt-rowCount"),"bottomRow")];return p.createTable(r)}}b.propTypes={columnToChecked:PropTypes.shape().isRequired,rowData:PropTypes.arrayOf(PropTypes.shape()).isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired};var T=ReactRedux.connect((e=>({columnToChecked:e.columnToChecked,rowData:e.filteredTableRows,tableColumns:e.tableColumns})))(b);const{FilterGroup:C,FilterGroupUI:y}=FilterJS;var f=ReactRedux.connect((e=>{const{filterGroup:t,tableColumns:o}=e;let r;r=t&&!Array.isArray(t)?t:C.default(o);return{initialFilterGroup:r,tableColumns:R.filter((e=>"none"!==e.type),o)}}),(e=>({applyOnClick:()=>{e(t.applyFilters())},onChange:o=>{e(t.setFilterGroup(o))},removeOnClick:()=>{e(t.removeFilters())}})))(y);class E extends React.PureComponent{constructor(e){super(e),this.handleChange=this.handleChangeFunction.bind(this)}handleChangeFunction(e){const{column:t,onChange:o}=this.props,{checked:r}=e.target;o(t.key,r)}render(){const{column:e,isChecked:t}=this.props,o=ReactDOMFactories.input({key:`${e.key}${t}`,type:"checkbox",checked:t,onChange:this.handleChange,style:{verticalAlign:"middle"}}),r=ReactDOMFactories.span({style:{verticalAlign:"middle"}},e.label);return ReactDOMFactories.label({style:{display:"block",verticalAlign:"middle"}},o,r)}}E.propTypes={column:PropTypes.shape().isRequired,onChange:PropTypes.func.isRequired,isChecked:PropTypes.bool},E.defaultProps={isChecked:!1};class k extends React.PureComponent{constructor(e){super(e);const{columnToChecked:t}=this.props;this.state={columnToChecked:t},this.handleApply=this.handleApplyFunction.bind(this),this.handleChange=this.handleChangeFunction.bind(this)}createButtonTable(){const e=ReactDOMFactories.button({onClick:this.handleApply},"Apply"),t=p.createCell(e,"applyButton","button"),o=p.createRow(t,"button-row");return p.createTable(o,"buttonTable","buttons")}handleApplyFunction(){const{applyOnClick:e}=this.props,{columnToChecked:t}=this.state;e(t)}handleChangeFunction(e,t){const{columnToChecked:o}=this.state,r=R.assoc(e,t,o);this.setState({columnToChecked:r})}render(){const{tableColumns:e}=this.props,{columnToChecked:t}=this.state,o=R.map((e=>{const o=t[e.key],r=React.createElement(E,{column:e,isChecked:o,onChange:this.handleChange}),s=p.createCell(r);return p.createRow(s,e.key)}),e),r=p.createTable(o,"checkboxTable","checkbox-panel"),s=p.createCell(this.createButtonTable(),"buttonTable","button-panel"),l=[p.createRow(r,"checkboxTableRow"),p.createRow(s,"buttonRow")];return p.createTable(l,"showColumnsTable","frt-show-columns")}}k.propTypes={columnToChecked:PropTypes.shape().isRequired,tableColumns:PropTypes.arrayOf(PropTypes.shape()).isRequired,applyOnClick:PropTypes.func.isRequired};var S=ReactRedux.connect((e=>{const{columnToChecked:t,tableColumns:o}=e;return{columnToChecked:t,tableColumns:o}}),(e=>({applyOnClick:o=>{e(t.applyShowColumns(o))}})))(k);const w=(e,t)=>{if(void 0===t)throw new Error(`Undefined parameter: ${e}`);if(!Array.isArray(t))throw new Error(`Parameter not an array: ${e}`)};return class{constructor(e,o,l,a,n,c){w("tableColumns",e),w("tableRows",o);let u=s.getColumnToChecked(l);0===Object.keys(u).length&&(u=(e=>R.reduce(((e,t)=>{const o=void 0===t.isShown||t.isShown;return R.assoc(t.key,o,e)}),{},e))(e));const p=R.pipe((e=>t=>{const o=R.reduce(((e,t)=>R.assoc(t.key,t,e)),{},e);return R.map((e=>{const t=Object.keys(e);return R.reduce(((t,r)=>{let s=e[r];const l=o[r];return l&&l.convertFunction&&(s=l.convertFunction(e)),R.assoc(r,s,t)}),{},t)}),t)})(e),(e=>t=>R.map((t=>R.reduce(((e,o)=>{if(o.valueFunction){const r=o.valueFunction(t);return R.assoc(`frt-value-${o.key}`,r,e)}return e}),t,e)),t))(e),(e=>t=>R.map((t=>R.reduce(((e,o)=>{if(o.cellFunction){const r=o.cellFunction(t);return R.assoc(`frt-cell-${o.key}`,r,e)}return e}),t,e)),t))(e))(o);this.store=Redux.createStore(i.root),this.store.dispatch(t.setTableColumns(e)),this.store.dispatch(t.applyShowColumns(u)),this.store.dispatch(t.setTableRows(p)),this.store.dispatch(t.setAppName(l)),this.store.dispatch(t.setVerbose(c));const d=s.getFilterGroup(l);if(this.store.dispatch(t.setFilterGroup(d)),a){const e=e=>e.filteredTableRows;r.observeStore(this.store,e,a)}if(n){const e=e=>e.columnToChecked;r.observeStore(this.store,e,n)}}filteredTableRows(){return u.filteredTableRows(this.store.getState())}filterElement(){const e=React.createElement(f);return React.createElement(ReactRedux.Provider,{key:"FRTFilterProvider",store:this.store},e)}filterPanel(e="Filters"){const t=this.filterElement();return React.createElement(d,{title:e,child:t})}showColumnsElement(){const e=React.createElement(S);return React.createElement(ReactRedux.Provider,{key:"FRTShowColumnsProvider",store:this.store},e)}showColumnsPanel(e="Columns"){const t=this.showColumnsElement();return React.createElement(d,{title:e,child:t})}tableElement(){const e=React.createElement(T);return React.createElement(ReactRedux.Provider,{key:"FRTTableProvider",store:this.store},e)}}}));
